{"ast":null,"code":"var _jsxFileName = \"D:\\\\fashion-shirt-shop\\\\DATN\\\\src\\\\main\\\\resources\\\\templates\\\\fashionshop-ui\\\\src\\\\layouts\\\\HoaDon\\\\UpdateOrderInfo\\\\UpdateOrderInfo.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useCallback } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { toast } from \"react-toastify\";\nimport axios from \"axios\";\n\n// --- MUI Imports ---\nimport { Dialog, DialogTitle, DialogContent, DialogActions, Button, TextField, Grid, Backdrop, CircularProgress, Typography, IconButton, Box, Autocomplete } from \"@mui/material\";\nimport CloseIcon from \"@mui/icons-material/Close\";\nimport \"react-toastify/dist/ReactToastify.css\";\n\n// --- GHN API Configuration ---\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst GHN_API_BASE_URL = \"https://online-gateway.ghn.vn/shiip/public-api\";\n// IMPORTANT: Replace with your actual GHN Token and Shop ID\nconst GHN_TOKEN = \"03b71be1-6891-11f0-9e03-7626358ab3e0\"; // Example Token\nconst GHN_SHOP_ID = 5908591; // Example Shop ID\n\nconst ghnApi = axios.create({\n  baseURL: GHN_API_BASE_URL,\n  headers: {\n    'token': GHN_TOKEN,\n    'Content-Type': 'application/json'\n  }\n});\n\n// --- Helper Functions ---\nconst normalizeString = (str = \"\") => {\n  if (typeof str !== \"string\") return \"\";\n  return str.toLowerCase().normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").replace(/đ/g, \"d\").replace(/Đ/g, \"D\").replace(/[\\s,.-]|(thành phố|tỉnh|quận|huyện|phường|xã|thị xã|thị trấn)/g, \"\");\n};\nconst formatCurrency = value => {\n  if (typeof value !== 'number') return \"N/A\";\n  return new Intl.NumberFormat('vi-VN', {\n    style: 'currency',\n    currency: 'VND'\n  }).format(value);\n};\nconst getEstimatedShippingFee = to_district_id => {\n  // This is a fallback function. You can implement more complex logic if needed.\n  if (to_district_id > 1500) return 35000;\n  return 25000;\n};\nconst UpdateOrderInfo = ({\n  show,\n  onClose,\n  orderId,\n  initialData,\n  onUpdateSuccess\n}) => {\n  _s();\n  // --- Component State ---\n  const [formData, setFormData] = useState({\n    tenNguoiNhan: \"\",\n    soDienThoai: \"\",\n    diaChiCuThe: \"\"\n  });\n  const [provinces, setProvinces] = useState([]);\n  const [districts, setDistricts] = useState([]);\n  const [wards, setWards] = useState([]);\n  const [selectedProvince, setSelectedProvince] = useState(null);\n  const [selectedDistrict, setSelectedDistrict] = useState(null);\n  const [selectedWard, setSelectedWard] = useState(null);\n  const [isPreloading, setIsPreloading] = useState(false);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [errors, setErrors] = useState({});\n\n  // --- NEW: State for Shipping Fee ---\n  const [shippingFee, setShippingFee] = useState(null);\n  const [isCalculatingFee, setIsCalculatingFee] = useState(false);\n\n  // --- Data Fetching and Initialization Effects ---\n\n  // Effect 1: Fetch provinces once when the modal is opened\n  useEffect(() => {\n    const fetchProvinces = async () => {\n      if (provinces.length === 0) {\n        setIsPreloading(true);\n        try {\n          var _response$data;\n          const response = await ghnApi.get('/master-data/province');\n          if ((_response$data = response.data) !== null && _response$data !== void 0 && _response$data.data) {\n            setProvinces(response.data.data);\n          }\n        } catch (error) {\n          console.error(\"Error fetching provinces from GHN:\", error);\n          toast.error(\"Không thể tải danh sách Tỉnh/Thành phố.\");\n        } finally {\n          setIsPreloading(false);\n        }\n      }\n    };\n    if (show) {\n      fetchProvinces();\n    }\n  }, [show, provinces.length]);\n\n  // Effect 2: Populate form with initial data and parse address\n  useEffect(() => {\n    if (!show || !initialData || provinces.length === 0) {\n      return;\n    }\n    const populateAddressData = async () => {\n      setIsPreloading(true);\n      setFormData({\n        tenNguoiNhan: initialData.tenNguoiNhan || \"\",\n        soDienThoai: initialData.soDienThoai || \"\",\n        diaChiCuThe: initialData.diaChi || \"\"\n      });\n      setSelectedProvince(null);\n      setSelectedDistrict(null);\n      setSelectedWard(null);\n      setDistricts([]);\n      setWards([]);\n      setShippingFee(initialData.phiVanChuyen || null); // Set initial fee\n\n      const addressString = initialData.diaChi || \"\";\n      const addressParts = addressString.split(\",\").map(part => part.trim());\n\n      // 1. Find Province\n      const foundProvince = provinces.find(p => addressParts.some(part => normalizeString(part) === normalizeString(p.ProvinceName)));\n      if (!foundProvince) {\n        console.warn(\"Could not match province for:\", addressString);\n        setIsPreloading(false);\n        return;\n      }\n      setSelectedProvince(foundProvince);\n      try {\n        var _districtResponse$dat, _wardResponse$data;\n        // 2. Fetch and find District\n        const districtResponse = await ghnApi.get('/master-data/district', {\n          params: {\n            province_id: foundProvince.ProvinceID\n          }\n        });\n        const availableDistricts = ((_districtResponse$dat = districtResponse.data) === null || _districtResponse$dat === void 0 ? void 0 : _districtResponse$dat.data) || [];\n        setDistricts(availableDistricts);\n        const foundDistrict = availableDistricts.find(d => addressParts.some(part => normalizeString(part) === normalizeString(d.DistrictName)));\n        if (!foundDistrict) {\n          console.warn(\"Could not match district for:\", addressString);\n          const specificAddress = addressString.replace(new RegExp(`,\\\\s*${foundProvince.ProvinceName}\\\\s*$`, 'i'), '').trim();\n          setFormData(prev => ({\n            ...prev,\n            diaChiCuThe: specificAddress\n          }));\n          setIsPreloading(false);\n          return;\n        }\n        setSelectedDistrict(foundDistrict);\n\n        // 3. Fetch and find Ward\n        const wardResponse = await ghnApi.get('/master-data/ward', {\n          params: {\n            district_id: foundDistrict.DistrictID\n          }\n        });\n        const availableWards = ((_wardResponse$data = wardResponse.data) === null || _wardResponse$data === void 0 ? void 0 : _wardResponse$data.data) || [];\n        setWards(availableWards);\n        const foundWard = availableWards.find(w => addressParts.some(part => normalizeString(part) === normalizeString(w.WardName)));\n        if (foundWard) {\n          setSelectedWard(foundWard);\n          // 4. Calculate final specific address\n          const specificAddress = addressParts.filter(part => normalizeString(part) !== normalizeString(foundProvince.ProvinceName) && normalizeString(part) !== normalizeString(foundDistrict.DistrictName) && normalizeString(part) !== normalizeString(foundWard.WardName)).join(\", \");\n          setFormData(prev => ({\n            ...prev,\n            diaChiCuThe: specificAddress\n          }));\n        } else {\n          console.warn(\"Could not match ward for:\", addressString);\n          let specificAddress = addressString.replace(new RegExp(`,\\\\s*${foundProvince.ProvinceName}\\\\s*$`, 'i'), '');\n          specificAddress = specificAddress.replace(new RegExp(`,\\\\s*${foundDistrict.DistrictName}\\\\s*$`, 'i'), '').trim();\n          setFormData(prev => ({\n            ...prev,\n            diaChiCuThe: specificAddress\n          }));\n        }\n      } catch (error) {\n        console.error(\"Error during address parsing:\", error);\n        toast.error(\"Đã xảy ra lỗi khi tự động điền địa chỉ.\");\n      } finally {\n        setIsPreloading(false);\n      }\n    };\n    populateAddressData();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [show, initialData, provinces]);\n\n  // --- NEW: Shipping Fee Calculation Logic ---\n  const calculateShippingFee = useCallback(async (to_district_id, to_ward_code) => {\n    if (!to_district_id || !to_ward_code) {\n      setShippingFee(0);\n      return;\n    }\n    setIsCalculatingFee(true);\n    setShippingFee(null);\n\n    // List of alternative \"from\" locations to try if one fails\n    const alternativeDistricts = [{\n      district_id: 1450,\n      ward_code: \"217010\",\n      name: \"Cầu Giấy (Primary)\"\n    }, {\n      district_id: 1442,\n      ward_code: \"21211\",\n      name: \"Ba Đình\"\n    }, {\n      district_id: 1443,\n      ward_code: \"21311\",\n      name: \"Hoàn Kiếm\"\n    }, {\n      district_id: 1447,\n      ward_code: \"21711\",\n      name: \"Đống Đa\"\n    }];\n    let calculatedFee = null;\n    for (const altDistrict of alternativeDistricts) {\n      const from_district_id = altDistrict.district_id;\n      try {\n        var _serviceResponse$data, _feeResponse$data, _feeResponse$data2, _feeResponse$data2$da;\n        // Step 1: Check for available services\n        const serviceResponse = await ghnApi.get('/v2/shipping-order/available-services', {\n          params: {\n            shop_id: GHN_SHOP_ID,\n            from_district: from_district_id,\n            to_district: to_district_id\n          }\n        });\n        if (!((_serviceResponse$data = serviceResponse.data) !== null && _serviceResponse$data !== void 0 && _serviceResponse$data.data) || serviceResponse.data.data.length === 0) {\n          console.log(`No GHN service available for from_district: ${altDistrict.name}`);\n          continue; // Try the next alternative\n        }\n        const service = serviceResponse.data.data[0]; // Use the first available service\n\n        // Step 2: Calculate the fee with the found service\n        const feePayload = {\n          from_district_id: from_district_id,\n          from_ward_code: altDistrict.ward_code,\n          to_district_id: to_district_id,\n          to_ward_code: to_ward_code,\n          service_id: service.service_id,\n          insurance_value: 0,\n          // Modify as needed\n          coupon: null,\n          weight: 500,\n          // Example weight in grams\n          length: 30,\n          // Example dimensions in cm\n          width: 15,\n          height: 20\n        };\n        const feeResponse = await ghnApi.post('/v2/shipping-order/fee', feePayload, {\n          headers: {\n            'ShopId': GHN_SHOP_ID\n          }\n        });\n        if (((_feeResponse$data = feeResponse.data) === null || _feeResponse$data === void 0 ? void 0 : _feeResponse$data.code) === 200 && (_feeResponse$data2 = feeResponse.data) !== null && _feeResponse$data2 !== void 0 && (_feeResponse$data2$da = _feeResponse$data2.data) !== null && _feeResponse$data2$da !== void 0 && _feeResponse$data2$da.total) {\n          console.log(`Successfully calculated fee with ${altDistrict.name}. Fee: ${feeResponse.data.data.total}`);\n          calculatedFee = feeResponse.data.data.total;\n          if (altDistrict.district_id !== 1450) {}\n          break; // Exit loop on success\n        }\n      } catch (error) {\n        var _error$response;\n        console.error(`Error calculating fee with ${altDistrict.name}:`, ((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.data) || error.message);\n        continue; // Try next on error\n      }\n    }\n    if (calculatedFee === null) {\n      console.warn(\"All GHN fee calculation attempts failed. Using fallback estimate.\");\n      calculatedFee = getEstimatedShippingFee(to_district_id);\n      toast.warning(`Không thể tính phí chính xác. Sử dụng phí ước tính: ${formatCurrency(calculatedFee)}`);\n    }\n    setShippingFee(calculatedFee);\n    setIsCalculatingFee(false);\n  }, []);\n\n  // Effect 3: Trigger fee calculation when address changes\n  useEffect(() => {\n    if (selectedDistrict && selectedWard) {\n      calculateShippingFee(selectedDistrict.DistrictID, selectedWard.WardCode);\n    } else {\n      setShippingFee(null); // Reset if address is incomplete\n    }\n  }, [selectedDistrict, selectedWard, calculateShippingFee]);\n\n  // --- Event Handlers ---\n\n  const handleProvinceChange = async newValue => {\n    setSelectedProvince(newValue);\n    setSelectedDistrict(null);\n    setDistricts([]);\n    setSelectedWard(null);\n    setWards([]);\n    if (newValue) {\n      try {\n        var _response$data2;\n        const response = await ghnApi.get('/master-data/district', {\n          params: {\n            province_id: newValue.ProvinceID\n          }\n        });\n        setDistricts(((_response$data2 = response.data) === null || _response$data2 === void 0 ? void 0 : _response$data2.data) || []);\n      } catch (error) {\n        toast.error(\"Không thể tải danh sách Quận/Huyện.\");\n      }\n    }\n  };\n  const handleDistrictChange = async newValue => {\n    setSelectedDistrict(newValue);\n    setSelectedWard(null);\n    setWards([]);\n    if (newValue) {\n      try {\n        var _response$data3;\n        const response = await ghnApi.get('/master-data/ward', {\n          params: {\n            district_id: newValue.DistrictID\n          }\n        });\n        setWards(((_response$data3 = response.data) === null || _response$data3 === void 0 ? void 0 : _response$data3.data) || []);\n      } catch (error) {\n        toast.error(\"Không thể tải danh sách Phường/Xã.\");\n      }\n    }\n  };\n  const handleSubmit = async e => {\n    e.preventDefault();\n    let newErrors = {};\n    if (!formData.tenNguoiNhan.trim()) newErrors.tenNguoiNhan = \"Tên người nhận là bắt buộc.\";\n    const phoneRegex = /^(0|\\+84)(3|5|7|8|9)[0-9]{8}$/;\n    if (!formData.soDienThoai.trim()) newErrors.soDienThoai = \"Số điện thoại là bắt buộc.\";else if (!phoneRegex.test(formData.soDienThoai.trim())) newErrors.soDienThoai = \"Định dạng số điện thoại không hợp lệ.\";\n    if (!selectedProvince) newErrors.province = \"Vui lòng chọn Tỉnh/Thành phố.\";\n    if (!selectedDistrict) newErrors.district = \"Vui lòng chọn Quận/Huyện.\";\n    if (!selectedWard) newErrors.ward = \"Vui lòng chọn Phường/Xã.\";\n    if (!formData.diaChiCuThe.trim()) newErrors.diaChiCuThe = \"Vui lòng nhập địa chỉ cụ thể.\";\n    if (shippingFee === null || isCalculatingFee) newErrors.fee = \"Phí vận chuyển đang được tính toán.\";\n    if (Object.keys(newErrors).length > 0) {\n      setErrors(newErrors);\n      return;\n    }\n    setIsSubmitting(true);\n    setErrors({});\n    const fullAddress = [formData.diaChiCuThe, selectedWard === null || selectedWard === void 0 ? void 0 : selectedWard.WardName, selectedDistrict === null || selectedDistrict === void 0 ? void 0 : selectedDistrict.DistrictName, selectedProvince === null || selectedProvince === void 0 ? void 0 : selectedProvince.ProvinceName].filter(Boolean).join(\", \");\n    const requestPayload = {\n      tenKhachHang: formData.tenNguoiNhan,\n      sdt: formData.soDienThoai,\n      diaChi: fullAddress,\n      phiVanChuyen: shippingFee,\n      // NEW: Include shipping fee\n      ghiChu: \"Cập nhật thông tin giao hàng\"\n    };\n    try {\n      // IMPORTANT: Replace with your actual backend API URL\n      const backendApiUrl = `http://localhost:8080/api/hoa-don/cap-nhat-thong-tin/${orderId}`;\n      await axios.put(backendApiUrl, requestPayload);\n      toast.success(\"Cập nhật thông tin đơn hàng thành công!\");\n      setTimeout(() => {\n        if (onClose) onClose();\n        if (onUpdateSuccess) onUpdateSuccess();\n      }, 500);\n    } catch (error) {\n      var _error$response2, _error$response2$data;\n      console.error(\"Error submitting update:\", error);\n      toast.error(`Lỗi: ${((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : (_error$response2$data = _error$response2.data) === null || _error$response2$data === void 0 ? void 0 : _error$response2$data.message) || \"Không thể cập nhật đơn hàng.\"}`);\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  // --- Render Method ---\n  return /*#__PURE__*/_jsxDEV(Dialog, {\n    open: show,\n    onClose: onClose,\n    maxWidth: \"md\",\n    fullWidth: true,\n    component: \"form\",\n    onSubmit: handleSubmit,\n    children: [/*#__PURE__*/_jsxDEV(DialogTitle, {\n      sx: {\n        m: 0,\n        p: 2,\n        fontWeight: 'bold'\n      },\n      children: [\"C\\u1EADp nh\\u1EADt th\\xF4ng tin giao h\\xE0ng\", /*#__PURE__*/_jsxDEV(IconButton, {\n        \"aria-label\": \"close\",\n        onClick: onClose,\n        sx: {\n          position: \"absolute\",\n          right: 8,\n          top: 8,\n          color: theme => theme.palette.grey[500]\n        },\n        children: /*#__PURE__*/_jsxDEV(CloseIcon, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 374,\n          columnNumber: 17\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 373,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 371,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(DialogContent, {\n      dividers: true,\n      children: [/*#__PURE__*/_jsxDEV(Backdrop, {\n        sx: {\n          color: \"#fff\",\n          zIndex: theme => theme.zIndex.drawer + 2,\n          position: \"absolute\"\n        },\n        open: isPreloading,\n        children: /*#__PURE__*/_jsxDEV(Box, {\n          display: \"flex\",\n          flexDirection: \"column\",\n          alignItems: \"center\",\n          children: [/*#__PURE__*/_jsxDEV(CircularProgress, {\n            color: \"inherit\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 380,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(Typography, {\n            sx: {\n              mt: 2\n            },\n            children: \"\\u0110ang t\\u1EA3i d\\u1EEF li\\u1EC7u ban \\u0111\\u1EA7u...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 381,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 379,\n          columnNumber: 17\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 378,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(Grid, {\n        container: true,\n        spacing: 3,\n        sx: {\n          pt: 1\n        },\n        children: [/*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          xs: 12,\n          md: 6,\n          children: /*#__PURE__*/_jsxDEV(TextField, {\n            fullWidth: true,\n            required: true,\n            name: \"tenNguoiNhan\",\n            label: \"T\\xEAn ng\\u01B0\\u1EDDi nh\\u1EADn\",\n            value: formData.tenNguoiNhan,\n            onChange: e => setFormData({\n              ...formData,\n              tenNguoiNhan: e.target.value\n            }),\n            error: !!errors.tenNguoiNhan,\n            helperText: errors.tenNguoiNhan || \" \"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 386,\n            columnNumber: 21\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 385,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          xs: 12,\n          md: 6,\n          children: /*#__PURE__*/_jsxDEV(TextField, {\n            fullWidth: true,\n            required: true,\n            name: \"soDienThoai\",\n            label: \"S\\u1ED1 \\u0111i\\u1EC7n tho\\u1EA1i\",\n            type: \"tel\",\n            value: formData.soDienThoai,\n            onChange: e => setFormData({\n              ...formData,\n              soDienThoai: e.target.value\n            }),\n            error: !!errors.soDienThoai,\n            helperText: errors.soDienThoai || \" \"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 389,\n            columnNumber: 21\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 388,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          xs: 12,\n          md: 4,\n          children: /*#__PURE__*/_jsxDEV(Autocomplete, {\n            options: provinces,\n            getOptionLabel: option => option.ProvinceName || \"\",\n            isOptionEqualToValue: (option, value) => option.ProvinceID === value.ProvinceID,\n            value: selectedProvince,\n            onChange: (event, newValue) => handleProvinceChange(newValue),\n            renderInput: params => /*#__PURE__*/_jsxDEV(TextField, {\n              ...params,\n              label: \"T\\u1EC9nh/Th\\xE0nh ph\\u1ED1\",\n              required: true,\n              error: !!errors.province,\n              helperText: errors.province || \" \"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 399,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 392,\n            columnNumber: 21\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 391,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          xs: 12,\n          md: 4,\n          children: /*#__PURE__*/_jsxDEV(Autocomplete, {\n            options: districts,\n            disabled: !selectedProvince,\n            getOptionLabel: option => option.DistrictName || \"\",\n            isOptionEqualToValue: (option, value) => option.DistrictID === value.DistrictID,\n            value: selectedDistrict,\n            onChange: (event, newValue) => handleDistrictChange(newValue),\n            renderInput: params => /*#__PURE__*/_jsxDEV(TextField, {\n              ...params,\n              label: \"Qu\\u1EADn/Huy\\u1EC7n\",\n              required: true,\n              error: !!errors.district,\n              helperText: errors.district || \" \"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 412,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 404,\n            columnNumber: 21\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 403,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          xs: 12,\n          md: 4,\n          children: /*#__PURE__*/_jsxDEV(Autocomplete, {\n            options: wards,\n            disabled: !selectedDistrict,\n            getOptionLabel: option => option.WardName || \"\",\n            isOptionEqualToValue: (option, value) => option.WardCode === value.WardCode,\n            value: selectedWard,\n            onChange: (event, newValue) => setSelectedWard(newValue),\n            renderInput: params => /*#__PURE__*/_jsxDEV(TextField, {\n              ...params,\n              label: \"Ph\\u01B0\\u1EDDng/X\\xE3\",\n              required: true,\n              error: !!errors.ward,\n              helperText: errors.ward || \" \"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 425,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 417,\n            columnNumber: 21\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 416,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          xs: 12,\n          children: /*#__PURE__*/_jsxDEV(TextField, {\n            fullWidth: true,\n            required: true,\n            name: \"diaChiCuThe\",\n            label: \"\\u0110\\u1ECBa ch\\u1EC9 c\\u1EE5 th\\u1EC3\",\n            placeholder: \"T\\xEAn \\u0111\\u01B0\\u1EDDng, s\\u1ED1 nh\\xE0...\",\n            value: formData.diaChiCuThe,\n            onChange: e => setFormData({\n              ...formData,\n              diaChiCuThe: e.target.value\n            }),\n            error: !!errors.diaChiCuThe,\n            helperText: errors.diaChiCuThe || \"Nhập tên đường, số nhà, v.v.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 430,\n            columnNumber: 21\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 429,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 384,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 377,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(DialogActions, {\n      sx: {\n        p: \"16px 24px\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(Button, {\n        onClick: onClose,\n        color: \"secondary\",\n        children: \"H\\u1EE7y\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 437,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        type: \"submit\",\n        variant: \"contained\",\n        size: \"medium\",\n        disabled: isSubmitting || isPreloading || isCalculatingFee,\n        startIcon: isSubmitting ? /*#__PURE__*/_jsxDEV(CircularProgress, {\n          size: 20,\n          color: \"inherit\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 438,\n          columnNumber: 155\n        }, this) : null,\n        children: isSubmitting ? \"Đang lưu...\" : \"Lưu thay đổi\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 438,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 436,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 370,\n    columnNumber: 5\n  }, this);\n};\n_s(UpdateOrderInfo, \"teR1n7oHXCjDHWNyvPNV0Kcubek=\");\n_c = UpdateOrderInfo;\nUpdateOrderInfo.propTypes = {\n  show: PropTypes.bool.isRequired,\n  onClose: PropTypes.func.isRequired,\n  orderId: PropTypes.oneOfType([PropTypes.string, PropTypes.number]).isRequired,\n  initialData: PropTypes.shape({\n    tenNguoiNhan: PropTypes.string,\n    soDienThoai: PropTypes.string,\n    diaChi: PropTypes.string,\n    phiVanChuyen: PropTypes.number // Expect initial fee\n  }).isRequired,\n  onUpdateSuccess: PropTypes.func\n};\nexport default UpdateOrderInfo;\nvar _c;\n$RefreshReg$(_c, \"UpdateOrderInfo\");","map":{"version":3,"names":["React","useState","useEffect","useCallback","PropTypes","toast","axios","Dialog","DialogTitle","DialogContent","DialogActions","Button","TextField","Grid","Backdrop","CircularProgress","Typography","IconButton","Box","Autocomplete","CloseIcon","jsxDEV","_jsxDEV","GHN_API_BASE_URL","GHN_TOKEN","GHN_SHOP_ID","ghnApi","create","baseURL","headers","normalizeString","str","toLowerCase","normalize","replace","formatCurrency","value","Intl","NumberFormat","style","currency","format","getEstimatedShippingFee","to_district_id","UpdateOrderInfo","show","onClose","orderId","initialData","onUpdateSuccess","_s","formData","setFormData","tenNguoiNhan","soDienThoai","diaChiCuThe","provinces","setProvinces","districts","setDistricts","wards","setWards","selectedProvince","setSelectedProvince","selectedDistrict","setSelectedDistrict","selectedWard","setSelectedWard","isPreloading","setIsPreloading","isSubmitting","setIsSubmitting","errors","setErrors","shippingFee","setShippingFee","isCalculatingFee","setIsCalculatingFee","fetchProvinces","length","_response$data","response","get","data","error","console","populateAddressData","diaChi","phiVanChuyen","addressString","addressParts","split","map","part","trim","foundProvince","find","p","some","ProvinceName","warn","_districtResponse$dat","_wardResponse$data","districtResponse","params","province_id","ProvinceID","availableDistricts","foundDistrict","d","DistrictName","specificAddress","RegExp","prev","wardResponse","district_id","DistrictID","availableWards","foundWard","w","WardName","filter","join","calculateShippingFee","to_ward_code","alternativeDistricts","ward_code","name","calculatedFee","altDistrict","from_district_id","_serviceResponse$data","_feeResponse$data","_feeResponse$data2","_feeResponse$data2$da","serviceResponse","shop_id","from_district","to_district","log","service","feePayload","from_ward_code","service_id","insurance_value","coupon","weight","width","height","feeResponse","post","code","total","_error$response","message","warning","WardCode","handleProvinceChange","newValue","_response$data2","handleDistrictChange","_response$data3","handleSubmit","e","preventDefault","newErrors","phoneRegex","test","province","district","ward","fee","Object","keys","fullAddress","Boolean","requestPayload","tenKhachHang","sdt","ghiChu","backendApiUrl","put","success","setTimeout","_error$response2","_error$response2$data","open","maxWidth","fullWidth","component","onSubmit","children","sx","m","fontWeight","onClick","position","right","top","color","theme","palette","grey","fileName","_jsxFileName","lineNumber","columnNumber","dividers","zIndex","drawer","display","flexDirection","alignItems","mt","container","spacing","pt","item","xs","md","required","label","onChange","target","helperText","type","options","getOptionLabel","option","isOptionEqualToValue","event","renderInput","disabled","placeholder","variant","size","startIcon","_c","propTypes","bool","isRequired","func","oneOfType","string","number","shape","$RefreshReg$"],"sources":["D:/fashion-shirt-shop/DATN/src/main/resources/templates/fashionshop-ui/src/layouts/HoaDon/UpdateOrderInfo/UpdateOrderInfo.jsx"],"sourcesContent":["import React, { useState, useEffect, useCallback } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { toast } from \"react-toastify\";\nimport axios from \"axios\";\n\n// --- MUI Imports ---\nimport {\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  Button,\n  TextField,\n  Grid,\n  Backdrop,\n  CircularProgress,\n  Typography,\n  IconButton,\n  Box,\n  Autocomplete,\n} from \"@mui/material\";\nimport CloseIcon from \"@mui/icons-material/Close\";\nimport \"react-toastify/dist/ReactToastify.css\";\n\n// --- GHN API Configuration ---\nconst GHN_API_BASE_URL = \"https://online-gateway.ghn.vn/shiip/public-api\";\n// IMPORTANT: Replace with your actual GHN Token and Shop ID\nconst GHN_TOKEN = \"03b71be1-6891-11f0-9e03-7626358ab3e0\"; // Example Token\nconst GHN_SHOP_ID = 5908591; // Example Shop ID\n\nconst ghnApi = axios.create({\n  baseURL: GHN_API_BASE_URL,\n  headers: {\n    'token': GHN_TOKEN,\n    'Content-Type': 'application/json'\n  }\n});\n\n// --- Helper Functions ---\nconst normalizeString = (str = \"\") => {\n  if (typeof str !== \"string\") return \"\";\n  return str\n    .toLowerCase()\n    .normalize(\"NFD\")\n    .replace(/[\\u0300-\\u036f]/g, \"\")\n    .replace(/đ/g, \"d\")\n    .replace(/Đ/g, \"D\")\n    .replace(/[\\s,.-]|(thành phố|tỉnh|quận|huyện|phường|xã|thị xã|thị trấn)/g, \"\");\n};\n\nconst formatCurrency = (value) => {\n    if (typeof value !== 'number') return \"N/A\";\n    return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(value);\n};\n\nconst getEstimatedShippingFee = (to_district_id) => {\n    // This is a fallback function. You can implement more complex logic if needed.\n    if (to_district_id > 1500) return 35000;\n    return 25000;\n};\n\n\nconst UpdateOrderInfo = ({ show, onClose, orderId, initialData, onUpdateSuccess }) => {\n  // --- Component State ---\n  const [formData, setFormData] = useState({ tenNguoiNhan: \"\", soDienThoai: \"\", diaChiCuThe: \"\" });\n  const [provinces, setProvinces] = useState([]);\n  const [districts, setDistricts] = useState([]);\n  const [wards, setWards] = useState([]);\n  const [selectedProvince, setSelectedProvince] = useState(null);\n  const [selectedDistrict, setSelectedDistrict] = useState(null);\n  const [selectedWard, setSelectedWard] = useState(null);\n  const [isPreloading, setIsPreloading] = useState(false);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [errors, setErrors] = useState({});\n\n  // --- NEW: State for Shipping Fee ---\n  const [shippingFee, setShippingFee] = useState(null);\n  const [isCalculatingFee, setIsCalculatingFee] = useState(false);\n\n\n  // --- Data Fetching and Initialization Effects ---\n\n  // Effect 1: Fetch provinces once when the modal is opened\n  useEffect(() => {\n    const fetchProvinces = async () => {\n      if (provinces.length === 0) {\n        setIsPreloading(true);\n        try {\n          const response = await ghnApi.get('/master-data/province');\n          if (response.data?.data) {\n            setProvinces(response.data.data);\n          }\n        } catch (error) {\n          console.error(\"Error fetching provinces from GHN:\", error);\n          toast.error(\"Không thể tải danh sách Tỉnh/Thành phố.\");\n        } finally {\n          setIsPreloading(false);\n        }\n      }\n    };\n    if (show) {\n      fetchProvinces();\n    }\n  }, [show, provinces.length]);\n\n  // Effect 2: Populate form with initial data and parse address\n  useEffect(() => {\n    if (!show || !initialData || provinces.length === 0) {\n      return;\n    }\n\n    const populateAddressData = async () => {\n        setIsPreloading(true);\n        setFormData({\n            tenNguoiNhan: initialData.tenNguoiNhan || \"\",\n            soDienThoai: initialData.soDienThoai || \"\",\n            diaChiCuThe: initialData.diaChi || \"\"\n        });\n        setSelectedProvince(null);\n        setSelectedDistrict(null);\n        setSelectedWard(null);\n        setDistricts([]);\n        setWards([]);\n        setShippingFee(initialData.phiVanChuyen || null); // Set initial fee\n\n        const addressString = initialData.diaChi || \"\";\n        const addressParts = addressString.split(\",\").map(part => part.trim());\n\n        // 1. Find Province\n        const foundProvince = provinces.find(p => addressParts.some(part => normalizeString(part) === normalizeString(p.ProvinceName)));\n        if (!foundProvince) {\n            console.warn(\"Could not match province for:\", addressString);\n            setIsPreloading(false);\n            return;\n        }\n        setSelectedProvince(foundProvince);\n\n        try {\n            // 2. Fetch and find District\n            const districtResponse = await ghnApi.get('/master-data/district', { params: { province_id: foundProvince.ProvinceID } });\n            const availableDistricts = districtResponse.data?.data || [];\n            setDistricts(availableDistricts);\n\n            const foundDistrict = availableDistricts.find(d => addressParts.some(part => normalizeString(part) === normalizeString(d.DistrictName)));\n            if (!foundDistrict) {\n                console.warn(\"Could not match district for:\", addressString);\n                const specificAddress = addressString.replace(new RegExp(`,\\\\s*${foundProvince.ProvinceName}\\\\s*$`, 'i'), '').trim();\n                setFormData(prev => ({ ...prev, diaChiCuThe: specificAddress }));\n                setIsPreloading(false);\n                return;\n            }\n            setSelectedDistrict(foundDistrict);\n\n            // 3. Fetch and find Ward\n            const wardResponse = await ghnApi.get('/master-data/ward', { params: { district_id: foundDistrict.DistrictID } });\n            const availableWards = wardResponse.data?.data || [];\n            setWards(availableWards);\n\n            const foundWard = availableWards.find(w => addressParts.some(part => normalizeString(part) === normalizeString(w.WardName)));\n            if (foundWard) {\n                setSelectedWard(foundWard);\n                // 4. Calculate final specific address\n                const specificAddress = addressParts.filter(part =>\n                    normalizeString(part) !== normalizeString(foundProvince.ProvinceName) &&\n                    normalizeString(part) !== normalizeString(foundDistrict.DistrictName) &&\n                    normalizeString(part) !== normalizeString(foundWard.WardName)\n                ).join(\", \");\n                setFormData(prev => ({...prev, diaChiCuThe: specificAddress}));\n            } else {\n                 console.warn(\"Could not match ward for:\", addressString);\n                 let specificAddress = addressString.replace(new RegExp(`,\\\\s*${foundProvince.ProvinceName}\\\\s*$`, 'i'), '');\n                 specificAddress = specificAddress.replace(new RegExp(`,\\\\s*${foundDistrict.DistrictName}\\\\s*$`, 'i'), '').trim();\n                 setFormData(prev => ({ ...prev, diaChiCuThe: specificAddress }));\n            }\n        } catch (error) {\n            console.error(\"Error during address parsing:\", error);\n            toast.error(\"Đã xảy ra lỗi khi tự động điền địa chỉ.\");\n        } finally {\n            setIsPreloading(false);\n        }\n    };\n\n    populateAddressData();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [show, initialData, provinces]);\n\n\n  // --- NEW: Shipping Fee Calculation Logic ---\n  const calculateShippingFee = useCallback(async (to_district_id, to_ward_code) => {\n    if (!to_district_id || !to_ward_code) {\n        setShippingFee(0);\n        return;\n    }\n\n    setIsCalculatingFee(true);\n    setShippingFee(null);\n\n    // List of alternative \"from\" locations to try if one fails\n    const alternativeDistricts = [\n        { district_id: 1450, ward_code: \"217010\", name: \"Cầu Giấy (Primary)\" },\n        { district_id: 1442, ward_code: \"21211\", name: \"Ba Đình\" },\n        { district_id: 1443, ward_code: \"21311\", name: \"Hoàn Kiếm\" },\n        { district_id: 1447, ward_code: \"21711\", name: \"Đống Đa\" },\n    ];\n\n    let calculatedFee = null;\n\n    for (const altDistrict of alternativeDistricts) {\n        const from_district_id = altDistrict.district_id;\n        \n        try {\n            // Step 1: Check for available services\n            const serviceResponse = await ghnApi.get('/v2/shipping-order/available-services', {\n                params: {\n                    shop_id: GHN_SHOP_ID,\n                    from_district: from_district_id,\n                    to_district: to_district_id,\n                }\n            });\n\n            if (!serviceResponse.data?.data || serviceResponse.data.data.length === 0) {\n                console.log(`No GHN service available for from_district: ${altDistrict.name}`);\n                continue; // Try the next alternative\n            }\n            \n            const service = serviceResponse.data.data[0]; // Use the first available service\n\n            // Step 2: Calculate the fee with the found service\n            const feePayload = {\n                from_district_id: from_district_id,\n                from_ward_code: altDistrict.ward_code,\n                to_district_id: to_district_id,\n                to_ward_code: to_ward_code,\n                service_id: service.service_id,\n                insurance_value: 0, // Modify as needed\n                coupon: null,\n                weight: 500, // Example weight in grams\n                length: 30, // Example dimensions in cm\n                width: 15,\n                height: 20,\n            };\n\n            const feeResponse = await ghnApi.post('/v2/shipping-order/fee', feePayload, {\n                headers: { 'ShopId': GHN_SHOP_ID }\n            });\n            \n            if (feeResponse.data?.code === 200 && feeResponse.data?.data?.total) {\n                console.log(`Successfully calculated fee with ${altDistrict.name}. Fee: ${feeResponse.data.data.total}`);\n                calculatedFee = feeResponse.data.data.total;\n                if (altDistrict.district_id !== 1450) { \n                   \n                }\n                break; // Exit loop on success\n            }\n\n        } catch (error) {\n            console.error(`Error calculating fee with ${altDistrict.name}:`, error.response?.data || error.message);\n            continue; // Try next on error\n        }\n    }\n\n    if (calculatedFee === null) {\n        console.warn(\"All GHN fee calculation attempts failed. Using fallback estimate.\");\n        calculatedFee = getEstimatedShippingFee(to_district_id);\n        toast.warning(`Không thể tính phí chính xác. Sử dụng phí ước tính: ${formatCurrency(calculatedFee)}`);\n    }\n    \n    setShippingFee(calculatedFee);\n    setIsCalculatingFee(false);\n  }, []);\n\n  // Effect 3: Trigger fee calculation when address changes\n  useEffect(() => {\n    if (selectedDistrict && selectedWard) {\n        calculateShippingFee(selectedDistrict.DistrictID, selectedWard.WardCode);\n    } else {\n        setShippingFee(null); // Reset if address is incomplete\n    }\n  }, [selectedDistrict, selectedWard, calculateShippingFee]);\n\n\n  // --- Event Handlers ---\n\n  const handleProvinceChange = async (newValue) => {\n    setSelectedProvince(newValue);\n    setSelectedDistrict(null);\n    setDistricts([]);\n    setSelectedWard(null);\n    setWards([]);\n\n    if (newValue) {\n      try {\n        const response = await ghnApi.get('/master-data/district', { params: { province_id: newValue.ProvinceID } });\n        setDistricts(response.data?.data || []);\n      } catch (error) {\n        toast.error(\"Không thể tải danh sách Quận/Huyện.\");\n      }\n    }\n  };\n\n  const handleDistrictChange = async (newValue) => {\n    setSelectedDistrict(newValue);\n    setSelectedWard(null);\n    setWards([]);\n\n    if (newValue) {\n      try {\n        const response = await ghnApi.get('/master-data/ward', { params: { district_id: newValue.DistrictID } });\n        setWards(response.data?.data || []);\n      } catch (error) {\n        toast.error(\"Không thể tải danh sách Phường/Xã.\");\n      }\n    }\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    let newErrors = {};\n    if (!formData.tenNguoiNhan.trim()) newErrors.tenNguoiNhan = \"Tên người nhận là bắt buộc.\";\n    const phoneRegex = /^(0|\\+84)(3|5|7|8|9)[0-9]{8}$/;\n    if (!formData.soDienThoai.trim()) newErrors.soDienThoai = \"Số điện thoại là bắt buộc.\";\n    else if (!phoneRegex.test(formData.soDienThoai.trim())) newErrors.soDienThoai = \"Định dạng số điện thoại không hợp lệ.\";\n    if (!selectedProvince) newErrors.province = \"Vui lòng chọn Tỉnh/Thành phố.\";\n    if (!selectedDistrict) newErrors.district = \"Vui lòng chọn Quận/Huyện.\";\n    if (!selectedWard) newErrors.ward = \"Vui lòng chọn Phường/Xã.\";\n    if (!formData.diaChiCuThe.trim()) newErrors.diaChiCuThe = \"Vui lòng nhập địa chỉ cụ thể.\";\n    if (shippingFee === null || isCalculatingFee) newErrors.fee = \"Phí vận chuyển đang được tính toán.\";\n\n\n    if (Object.keys(newErrors).length > 0) {\n      setErrors(newErrors);\n      return;\n    }\n\n    setIsSubmitting(true);\n    setErrors({});\n\n    const fullAddress = [formData.diaChiCuThe, selectedWard?.WardName, selectedDistrict?.DistrictName, selectedProvince?.ProvinceName].filter(Boolean).join(\", \");\n\n    const requestPayload = {\n      tenKhachHang: formData.tenNguoiNhan,\n      sdt: formData.soDienThoai,\n      diaChi: fullAddress,\n      phiVanChuyen: shippingFee, // NEW: Include shipping fee\n      ghiChu: \"Cập nhật thông tin giao hàng\",\n    };\n\n    try {\n      // IMPORTANT: Replace with your actual backend API URL\n      const backendApiUrl = `http://localhost:8080/api/hoa-don/cap-nhat-thong-tin/${orderId}`;\n      await axios.put(backendApiUrl, requestPayload);\n      toast.success(\"Cập nhật thông tin đơn hàng thành công!\");\n      \n      setTimeout(() => {\n        if (onClose) onClose();\n        if (onUpdateSuccess) onUpdateSuccess();\n      }, 500);\n\n    } catch (error) {\n      console.error(\"Error submitting update:\", error);\n      toast.error(`Lỗi: ${error.response?.data?.message || \"Không thể cập nhật đơn hàng.\"}`);\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n\n  // --- Render Method ---\n  return (\n    <Dialog open={show} onClose={onClose} maxWidth=\"md\" fullWidth component=\"form\" onSubmit={handleSubmit}>\n        <DialogTitle sx={{ m: 0, p: 2, fontWeight: 'bold' }}>\n            Cập nhật thông tin giao hàng\n            <IconButton aria-label=\"close\" onClick={onClose} sx={{ position: \"absolute\", right: 8, top: 8, color: (theme) => theme.palette.grey[500] }}>\n                <CloseIcon />\n            </IconButton>\n        </DialogTitle>\n        <DialogContent dividers>\n            <Backdrop sx={{ color: \"#fff\", zIndex: (theme) => theme.zIndex.drawer + 2, position: \"absolute\" }} open={isPreloading}>\n                <Box display=\"flex\" flexDirection=\"column\" alignItems=\"center\">\n                    <CircularProgress color=\"inherit\" />\n                    <Typography sx={{ mt: 2 }}>Đang tải dữ liệu ban đầu...</Typography>\n                </Box>\n            </Backdrop>\n            <Grid container spacing={3} sx={{ pt: 1 }}>\n                <Grid item xs={12} md={6}>\n                    <TextField fullWidth required name=\"tenNguoiNhan\" label=\"Tên người nhận\" value={formData.tenNguoiNhan} onChange={(e) => setFormData({ ...formData, tenNguoiNhan: e.target.value })} error={!!errors.tenNguoiNhan} helperText={errors.tenNguoiNhan || \" \"} />\n                </Grid>\n                <Grid item xs={12} md={6}>\n                    <TextField fullWidth required name=\"soDienThoai\" label=\"Số điện thoại\" type=\"tel\" value={formData.soDienThoai} onChange={(e) => setFormData({ ...formData, soDienThoai: e.target.value })} error={!!errors.soDienThoai} helperText={errors.soDienThoai || \" \"} />\n                </Grid>\n                <Grid item xs={12} md={4}>\n                    <Autocomplete\n                        options={provinces}\n                        getOptionLabel={(option) => option.ProvinceName || \"\"}\n                        isOptionEqualToValue={(option, value) => option.ProvinceID === value.ProvinceID}\n                        value={selectedProvince}\n                        onChange={(event, newValue) => handleProvinceChange(newValue)}\n                        renderInput={(params) => (\n                            <TextField {...params} label=\"Tỉnh/Thành phố\" required error={!!errors.province} helperText={errors.province || \" \"} />\n                        )}\n                    />\n                </Grid>\n                <Grid item xs={12} md={4}>\n                    <Autocomplete\n                        options={districts}\n                        disabled={!selectedProvince}\n                        getOptionLabel={(option) => option.DistrictName || \"\"}\n                        isOptionEqualToValue={(option, value) => option.DistrictID === value.DistrictID}\n                        value={selectedDistrict}\n                        onChange={(event, newValue) => handleDistrictChange(newValue)}\n                        renderInput={(params) => (\n                            <TextField {...params} label=\"Quận/Huyện\" required error={!!errors.district} helperText={errors.district || \" \"} />\n                        )}\n                    />\n                </Grid>\n                <Grid item xs={12} md={4}>\n                    <Autocomplete\n                        options={wards}\n                        disabled={!selectedDistrict}\n                        getOptionLabel={(option) => option.WardName || \"\"}\n                        isOptionEqualToValue={(option, value) => option.WardCode === value.WardCode}\n                        value={selectedWard}\n                        onChange={(event, newValue) => setSelectedWard(newValue)}\n                        renderInput={(params) => (\n                            <TextField {...params} label=\"Phường/Xã\" required error={!!errors.ward} helperText={errors.ward || \" \"} />\n                        )}\n                    />\n                </Grid>\n                <Grid item xs={12}>\n                    <TextField fullWidth required name=\"diaChiCuThe\" label=\"Địa chỉ cụ thể\" placeholder=\"Tên đường, số nhà...\" value={formData.diaChiCuThe} onChange={(e) => setFormData({ ...formData, diaChiCuThe: e.target.value })} error={!!errors.diaChiCuThe} helperText={errors.diaChiCuThe || \"Nhập tên đường, số nhà, v.v.\"} />\n                </Grid>\n                \n                \n            </Grid>\n        </DialogContent>\n        <DialogActions sx={{ p: \"16px 24px\" }}>\n            <Button onClick={onClose} color=\"secondary\">Hủy</Button>\n            <Button type=\"submit\" variant=\"contained\" size=\"medium\" disabled={isSubmitting || isPreloading || isCalculatingFee} startIcon={isSubmitting ? <CircularProgress size={20} color=\"inherit\" /> : null}>\n                {isSubmitting ? \"Đang lưu...\" : \"Lưu thay đổi\"}\n            </Button>\n        </DialogActions>\n    </Dialog>\n  );\n};\n\nUpdateOrderInfo.propTypes = {\n    show: PropTypes.bool.isRequired,\n    onClose: PropTypes.func.isRequired,\n    orderId: PropTypes.oneOfType([PropTypes.string, PropTypes.number]).isRequired,\n    initialData: PropTypes.shape({\n        tenNguoiNhan: PropTypes.string,\n        soDienThoai: PropTypes.string,\n        diaChi: PropTypes.string,\n        phiVanChuyen: PropTypes.number, // Expect initial fee\n    }).isRequired,\n    onUpdateSuccess: PropTypes.func,\n};\n\nexport default UpdateOrderInfo;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}