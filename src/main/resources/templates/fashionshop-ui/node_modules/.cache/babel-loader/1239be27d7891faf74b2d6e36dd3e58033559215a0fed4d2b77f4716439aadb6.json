{"ast":null,"code":"// Lấy danh sách phiếu giảm giá với filter và phân trang (POST theo backend custom)\nexport async function fetchVouchersAlternative(page, size, search, statusFilter) {\n  try {\n    const searchObject = {};\n    if (search && search.trim() !== \"\") {\n      // Nếu backend tìm theo OR thì nên chỉ truyền 1 trường, nếu AND thì truyền cả hai\n      searchObject.maPhieuGiamGia = search.trim();\n      searchObject.tenPhieu = search.trim();\n    }\n    // Bộ lọc trạng thái\n    if (statusFilter && statusFilter !== \"Tất cả\") {\n      const statusMap = {\n        \"Đang diễn ra\": 1,\n        \"Đã kết thúc\": 0,\n        \"Tạm dừng\": 3,\n        \"Chưa bắt đầu\": 2\n      };\n      if (statusMap.hasOwnProperty(statusFilter)) {\n        searchObject.trangThai = statusMap[statusFilter];\n      }\n    }\n    const response = await fetch(`http://localhost:8080/phieu_giam_gia/findAll?page=${page}&size=${size}`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(searchObject)\n    });\n    if (!response.ok) {\n      // Có thể lấy thêm response json để lấy thông điệp lỗi chi tiết\n      let errorMsg = 'Không thể lấy dữ liệu phiếu giảm giá';\n      try {\n        const err = await response.json();\n        if (err && err.message) errorMsg = err.message;\n      } catch {}\n      throw new Error(errorMsg);\n    }\n    const data = await response.json();\n    return data;\n  } catch (error) {\n    console.error(\"Lỗi khi lấy dữ liệu phiếu giảm giá:\", error);\n    throw error;\n  }\n}\n\n// Cập nhật trạng thái phiếu giảm giá (POST)\nexport async function updateStatustVoucher(id, status) {\n  try {\n    // status nên là số nguyên, không phải object\n    const response = await fetch(`http://localhost:8080/phieu_giam_gia/updateStatus/${id}`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(status)\n    });\n    if (!response.ok) {\n      let errorMsg = \"Failed to update voucher status\";\n      try {\n        const err = await response.json();\n        if (err && err.message) errorMsg = err.message;\n      } catch {}\n      throw new Error(errorMsg);\n    }\n    const result = await response.json();\n    return result;\n  } catch (error) {\n    console.error(\"Error updating voucher status:\", error);\n    return null;\n  }\n}\n\n// Thêm mới phiếu giảm giá\nexport async function addVouchers(data) {\n  try {\n    const response = await fetch(\"http://localhost:8080/phieu_giam_gia\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(data)\n    });\n    if (!response.ok) {\n      let errorMsg = \"Failed to add voucher\";\n      try {\n        const err = await response.json();\n        if (err && err.message) errorMsg = err.message;\n      } catch {}\n      throw new Error(errorMsg);\n    }\n    const result = await response.json();\n    return result;\n  } catch (error) {\n    console.error(\"Error adding voucher:\", error);\n    return null;\n  }\n}\n\n// Lấy 1 phiếu giảm giá theo id\nexport async function fetchOneVouchers(id) {\n  try {\n    const response = await fetch(`http://localhost:8080/phieu_giam_gia/${id}`);\n    if (!response.ok) {\n      let errorMsg = \"Failed to fetch vouchers\";\n      try {\n        const err = await response.json();\n        if (err && err.message) errorMsg = err.message;\n      } catch {}\n      throw new Error(errorMsg);\n    }\n    const data = await response.json();\n    return data.data;\n  } catch (error) {\n    console.error(\"Error fetching vouchers:\", error);\n    return null;\n  }\n}\n\n// Cập nhật phiếu giảm giá\nexport async function updateVouchers(data) {\n  try {\n    const response = await fetch(\"http://localhost:8080/phieu_giam_gia\", {\n      method: \"PUT\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(data)\n    });\n    if (!response.ok) {\n      let errorMsg = \"Failed to update voucher\";\n      try {\n        const err = await response.json();\n        if (err && err.message) errorMsg = err.message;\n      } catch {}\n      throw new Error(errorMsg);\n    }\n    const result = await response.json();\n    return result;\n  } catch (error) {\n    console.error(\"Error updating voucher:\", error);\n    return null;\n  }\n}\n\n// Gửi mail thông báo phiếu giảm giá\nexport async function sendMail(data) {\n  try {\n    const response = await fetch(\"http://localhost:8080/phieu_giam_gia/sendMail\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(data)\n    });\n    if (!response.ok) {\n      throw new Error(\"Failed to add voucher\");\n    }\n    const result = await response.json();\n    return result;\n  } catch (error) {\n    console.error(\"Error adding voucher:\", error);\n    return null;\n  }\n}","map":{"version":3,"names":["fetchVouchersAlternative","page","size","search","statusFilter","searchObject","trim","maPhieuGiamGia","tenPhieu","statusMap","hasOwnProperty","trangThai","response","fetch","method","headers","body","JSON","stringify","ok","errorMsg","err","json","message","Error","data","error","console","updateStatustVoucher","id","status","result","addVouchers","fetchOneVouchers","updateVouchers","sendMail"],"sources":["D:/fashion-shirt-shop/DATN/src/main/resources/templates/fashionshop-ui/src/layouts/phieugiamgia/service/PhieuGiamService.js"],"sourcesContent":["// Lấy danh sách phiếu giảm giá với filter và phân trang (POST theo backend custom)\r\nexport async function fetchVouchersAlternative(page, size, search, statusFilter) {\r\n    try {\r\n        const searchObject = {};\r\n        if (search && search.trim() !== \"\") {\r\n            // Nếu backend tìm theo OR thì nên chỉ truyền 1 trường, nếu AND thì truyền cả hai\r\n            searchObject.maPhieuGiamGia = search.trim();\r\n            searchObject.tenPhieu = search.trim();\r\n        }\r\n        // Bộ lọc trạng thái\r\n        if (statusFilter && statusFilter !== \"Tất cả\") {\r\n            const statusMap = {\r\n                \"Đang diễn ra\": 1,\r\n                \"Đã kết thúc\": 0,\r\n                \"Tạm dừng\": 3,\r\n                \"Chưa bắt đầu\": 2\r\n            };\r\n            if (statusMap.hasOwnProperty(statusFilter)) {\r\n                searchObject.trangThai = statusMap[statusFilter];\r\n            }\r\n        }\r\n        const response = await fetch(`http://localhost:8080/phieu_giam_gia/findAll?page=${page}&size=${size}`, {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n            },\r\n            body: JSON.stringify(searchObject),\r\n        });\r\n\r\n        if (!response.ok) {\r\n            // Có thể lấy thêm response json để lấy thông điệp lỗi chi tiết\r\n            let errorMsg = 'Không thể lấy dữ liệu phiếu giảm giá';\r\n            try {\r\n                const err = await response.json();\r\n                if (err && err.message) errorMsg = err.message;\r\n            } catch {}\r\n            throw new Error(errorMsg);\r\n        }\r\n        const data = await response.json();\r\n        return data;\r\n    } catch (error) {\r\n        console.error(\"Lỗi khi lấy dữ liệu phiếu giảm giá:\", error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n// Cập nhật trạng thái phiếu giảm giá (POST)\r\nexport async function updateStatustVoucher(id, status) {\r\n    try {\r\n        // status nên là số nguyên, không phải object\r\n        const response = await fetch(`http://localhost:8080/phieu_giam_gia/updateStatus/${id}`, {\r\n            method: \"POST\",\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n            },\r\n            body: JSON.stringify(status),\r\n        });\r\n\r\n        if (!response.ok) {\r\n            let errorMsg = \"Failed to update voucher status\";\r\n            try {\r\n                const err = await response.json();\r\n                if (err && err.message) errorMsg = err.message;\r\n            } catch {}\r\n            throw new Error(errorMsg);\r\n        }\r\n        const result = await response.json();\r\n        return result;\r\n    } catch (error) {\r\n        console.error(\"Error updating voucher status:\", error);\r\n        return null;\r\n    }\r\n}\r\n\r\n// Thêm mới phiếu giảm giá\r\nexport async function addVouchers(data) {\r\n    try {\r\n        const response = await fetch(\"http://localhost:8080/phieu_giam_gia\", {\r\n            method: \"POST\",\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n            },\r\n            body: JSON.stringify(data),\r\n        });\r\n\r\n        if (!response.ok) {\r\n            let errorMsg = \"Failed to add voucher\";\r\n            try {\r\n                const err = await response.json();\r\n                if (err && err.message) errorMsg = err.message;\r\n            } catch {}\r\n            throw new Error(errorMsg);\r\n        }\r\n        const result = await response.json();\r\n        return result;\r\n    } catch (error) {\r\n        console.error(\"Error adding voucher:\", error);\r\n        return null;\r\n    }\r\n}\r\n\r\n// Lấy 1 phiếu giảm giá theo id\r\nexport async function fetchOneVouchers(id) {\r\n    try {\r\n        const response = await fetch(`http://localhost:8080/phieu_giam_gia/${id}`);\r\n        if (!response.ok) {\r\n            let errorMsg = \"Failed to fetch vouchers\";\r\n            try {\r\n                const err = await response.json();\r\n                if (err && err.message) errorMsg = err.message;\r\n            } catch {}\r\n            throw new Error(errorMsg);\r\n        }\r\n        const data = await response.json();\r\n        return data.data;\r\n    } catch (error) {\r\n        console.error(\"Error fetching vouchers:\", error);\r\n        return null;\r\n    }\r\n}\r\n\r\n// Cập nhật phiếu giảm giá\r\nexport async function updateVouchers(data) {\r\n    try {\r\n        const response = await fetch(\"http://localhost:8080/phieu_giam_gia\", {\r\n            method: \"PUT\",\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n            },\r\n            body: JSON.stringify(data),\r\n        });\r\n\r\n        if (!response.ok) {\r\n            let errorMsg = \"Failed to update voucher\";\r\n            try {\r\n                const err = await response.json();\r\n                if (err && err.message) errorMsg = err.message;\r\n            } catch {}\r\n            throw new Error(errorMsg);\r\n        }\r\n        const result = await response.json();\r\n        return result;\r\n    } catch (error) {\r\n        console.error(\"Error updating voucher:\", error);\r\n        return null;\r\n    }\r\n}\r\n\r\n// Gửi mail thông báo phiếu giảm giá\r\nexport async function sendMail(data) {\r\n    try {\r\n        const response = await fetch(\"http://localhost:8080/phieu_giam_gia/sendMail\", {\r\n            method: \"POST\",\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n            },\r\n            body: JSON.stringify(data),\r\n        });\r\n\r\n        if (!response.ok) {\r\n            throw new Error(\"Failed to add voucher\");\r\n        }\r\n\r\n        const result = await response.json();\r\n        return result;\r\n    } catch (error) {\r\n        console.error(\"Error adding voucher:\", error);\r\n        return null;\r\n    }\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}